<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Pollen ¬∑ jar.plnt.earth</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Ctext y='0.9em' font-size='90'%3Eüêù%3C/text%3E%3C/svg%3E">
<style>
:root{--bg:#0b0b0d;--panel:#121216;--ink:#eaeaf2;--muted:#a9adc2;--accent:#9dfcff;--accent2:#ffd36b}
*{box-sizing:border-box}body{margin:0;background:radial-gradient(1200px 800px at 10% -10%,rgba(157,252,255,.06),transparent),radial-gradient(900px 600px at 110% 10%,rgba(255,211,107,.06),transparent),var(--bg);color:var(--ink);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
a{color:var(--accent);text-decoration:none}a:hover{opacity:.9}
.wrap{max-width:1100px;margin:auto;padding:20px}
header{display:flex;flex-wrap:wrap;gap:10px 16px;align-items:center;justify-content:space-between;margin-bottom:16px}
.brand{display:flex;align-items:center;gap:10px}.dot{width:12px;height:12px;border-radius:999px;background:linear-gradient(135deg,var(--accent),var(--accent2))}
nav a{padding:8px 10px;background:#191922;border:1px solid #22232c;border-radius:10px;color:#e9ecff;text-decoration:none}
h1{font-size:24px;margin:8px 0 4px}.sub{color:var(--muted)}
.panel{background:#121216;border:1px solid #1e2030;border-radius:16px;padding:14px;box-shadow:0 0 0 1px rgba(157,252,255,.03) inset}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.input,textarea,select{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #2a2d40;background:#10111a;color:#eaeaf2}
.list{max-height:360px;overflow:auto;border:1px solid #1f2030;border-radius:12px}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #2a2d40;background:#141623;color:#cfd3ea;font-size:12px}
.btn{padding:10px 12px;border-radius:10px;border:1px solid #23263a;background:#151726;color:#e9ecff}
.svg{width:100%;height:320px;background:#0f1119;border:1px solid #1f2030;border-radius:12px}
.footer{margin-top:12px;color:var(--muted);display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap}
@media (max-width:900px){.grid{grid-template-columns:1fr}}
</style>
<body>
<div class="wrap">
  <header>
    <div class="brand"><div class="dot"></div><div><h1>Pollen</h1><div class="sub">Bee trails across cycles</div></div></div>
    <nav>
      <a href="/jar/">Jar</a><a href="/calendar/illumina1/">Calendar</a><a href="/day/">Day</a>
      <a href="/tunes/">Tunes</a><a href="/interludes/">Interludes</a><a href="/seeds/">Seeds</a>
      <a href="/references/">References</a><a href="/archive/">Archive</a><a href="/science/">Science</a>
      <a href="/compatibility/">Compatibility</a><a href="/dreams/">Dreams</a><a href="/storage/">Storage</a><a href="/pollen/">Pollen</a><a href="/modes/neon/">Modes</a>
    </nav>
  </header>

  <div class="panel">
    <h3>Add Bee Trail</h3>
    <div class="field"><label>From (cycle-day)</label>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <input id="fromCycle" class="input" type="number" min="1" max="7" value="1" />
        <input id="fromDay" class="input" type="number" min="1" max="42" value="1" />
      </div>
    </div>
    <div class="field"><label>To (cycle-day)</label>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <input id="toCycle" class="input" type="number" min="1" max="7" value="1" />
        <input id="toDay" class="input" type="number" min="1" max="42" value="7" />
      </div>
    </div>
    <div class="field"><label>Note</label><input id="pNote" class="input" placeholder="What carries forward?"></div>
    <button class="btn" id="addBtn">Add Trail</button>
  </div>

  <div class="panel">
    <h3>Map</h3>
    <svg id="map" viewBox="0 0 1000 320" preserveAspectRatio="none" aria-label="Pollen map"></svg>
    <div class="sub" style="margin-top:6px">Each row = an Illumina (1..7). Columns are days (1..42). Lines show trails.</div>
  </div>

  <div class="panel">
    <h3>Trails</h3>
    <div class="list">
      <table id="list"><thead><tr><th>From</th><th>To</th><th>Note</th><th></th></tr></thead><tbody></tbody></table>
    </div>
  </div>

  <div class="panel" style="margin-top:12px">
    <button class="btn" id="exportBtn">Export JSON</button>
    <label class="btn" for="importFile" style="cursor:pointer">Import JSON</label>
    <input id="importFile" type="file" accept="application/json" class="hidden">
    <button class="btn" id="resetBtn">Reset</button>
  </div>

  <div class="footer">
    <div>Local key: <span class="badge">jar_pollen_v1</span></div>
    <div>Tip: Use trails to hint ‚Äúwhat to carry‚Äù into the next cycle.</div>
  </div>
</div>

<script>
const KEY="jar_pollen_v1";
const svg=document.getElementById("map");
const tBody=document.querySelector("#list tbody");
const fromCycle=document.getElementById("fromCycle"), fromDay=document.getElementById("fromDay");
const toCycle=document.getElementById("toCycle"), toDay=document.getElementById("toDay"), pNote=document.getElementById("pNote");
function load(){try{const raw=localStorage.getItem(KEY);return raw?JSON.parse(raw):[]}catch(_){return []}}
function save(rows){localStorage.setItem(KEY,JSON.stringify(rows))}
function add(){const rows=load(); rows.push({fc:+fromCycle.value, fd:+fromDay.value, tc:+toCycle.value, td:+toDay.value, note:pNote.value.trim()}); save(rows); render()}
function del(i){const rows=load(); rows.splice(i,1); save(rows); render()}
function pxFor(cycle,day){const w=980,h=300,left=10,top=10,rowH=h/7; const x=left+(day-1)*(w/42); const y=top+(cycle-0.5)*rowH; return {x,y}}
function drawBase(){while(svg.firstChild) svg.removeChild(svg.firstChild); const ns="http://www.w3.org/2000/svg"; for(let c=1;c<=7;c++){const y=pxFor(c,1).y; const line=document.createElementNS(ns,"line"); line.setAttribute("x1","10"); line.setAttribute("x2","990"); line.setAttribute("y1",String(y)); line.setAttribute("y2",String(y)); line.setAttribute("stroke","#24283a"); line.setAttribute("stroke-width","1"); svg.appendChild(line); for(let d=1; d<=42; d+=7){const m=document.createElementNS(ns,"circle"); const p=pxFor(c,d); m.setAttribute("cx",String(p.x)); m.setAttribute("cy",String(p.y)); m.setAttribute("r","3"); m.setAttribute("class","node"); svg.appendChild(m)}}}
function drawLinks(rows){const ns="http://www.w3.org/2000/svg"; rows.forEach(r=>{const a=pxFor(r.fc,r.fd), b=pxFor(r.tc,r.td); const path=document.createElementNS(ns,"path"); const midX=(a.x+b.x)/2, dy=(b.y-a.y); const d=`M ${a.x} ${a.y} C ${midX} ${a.y-dy*0.2}, ${midX} ${b.y+dy*0.2}, ${b.x} ${b.y}`; path.setAttribute("d",d); path.setAttribute("class","link"); path.setAttribute("pathLength","1"); path.style.strokeDasharray="1"; path.style.strokeDashoffset="1"; svg.appendChild(path); setTimeout(()=>{path.style.transition="stroke-dashoffset 900ms ease"; path.style.strokeDashoffset="0"},0)})}
function renderList(rows){tBody.innerHTML=""; rows.forEach((r,i)=>{const tr=document.createElement("tr"); tr.innerHTML=`<td>${r.fc}/${r.fd}</td><td>${r.tc}/${r.td}</td><td>${(r.note||"").replace(/</g,"&lt;")}</td><td><button class="btn" data-del="${i}">‚úï</button></td>`; tBody.appendChild(tr)})}
function render(){const rows=load(); drawBase(); drawLinks(rows); renderList(rows)}
document.getElementById("addBtn").addEventListener("click",add);
document.getElementById("exportBtn").addEventListener("click",()=>{const blob=new Blob([localStorage.getItem(KEY)||"[]"],{type:"application/json"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="jar_pollen.json";document.body.appendChild(a);a.click();a.remove();setTimeout(()=>URL.revokeObjectURL(url),500)});
document.getElementById("importFile").addEventListener("change",e=>{const f=e.target.files&&e.target.files[0];if(!f)return;const fr=new FileReader();fr.onload=()=>{try{const data=JSON.parse(fr.result);if(Array.isArray(data)){localStorage.setItem(KEY,JSON.stringify(data)); render();}}catch(_){ } e.target.value=""};fr.readAsText(f)});
document.getElementById("resetBtn").addEventListener("click",()=>{localStorage.removeItem(KEY); render()})();
(function init(){render()})();
</script>
