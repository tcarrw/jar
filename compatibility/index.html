<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Compatibility Grid Â· jar.plnt.earth</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Ctext y='0.9em' font-size='90'%3EðŸ”—%3C/text%3E%3C/svg%3E">
<style>
:root{--bg:#0b0b0d;--panel:#121216;--ink:#eaeaf2;--muted:#a9adc2;--accent:#9dfcff;--accent2:#ffd36b;--grid:#1b1b22}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:
  radial-gradient(1200px 800px at 10% -10%,rgba(157,252,255,.06),transparent 60%),
  radial-gradient(900px 600px at 110% 10%,rgba(255,211,107,.06),transparent 60%),
  var(--bg);color:var(--ink);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
a{color:var(--accent);text-decoration:none}a:hover{opacity:.9}
.wrap{max-width:1100px;margin:auto;padding:20px}
header{display:flex;flex-wrap:wrap;gap:10px 16px;align-items:center;justify-content:space-between;margin-bottom:16px}
.brand{display:flex;align-items:center;gap:10px}
.dot{width:12px;height:12px;border-radius:999px;background:linear-gradient(135deg,var(--accent),var(--accent2))}
h1{font-size:24px;margin:8px 0 4px}
.sub{color:var(--muted)}
nav{display:flex;flex-wrap:wrap;gap:8px}
nav a{padding:8px 10px;background:#191922;border:1px solid #22232c;border-radius:10px;color:#e9ecff}
.panel{background:#121216;border:1px solid #1e2030;border-radius:16px;padding:14px;box-shadow:0 0 0 1px rgba(157,252,255,.03) inset}
.gridwrap{overflow:auto;border-radius:14px;border:1px solid #1f2030}
table{border-collapse:separate;border-spacing:0;width:100%;min-width:760px;background:linear-gradient(0deg,rgba(255,255,255,.02),rgba(255,255,255,.02))}
th,td{padding:10px 12px;border-right:1px solid var(--grid);border-bottom:1px solid var(--grid);vertical-align:middle}
th{position:sticky;top:0;background:#11121a;z-index:2}
tr th:first-child, tr td:first-child{left:0;position:sticky;background:#10111a;z-index:3}
thead th{font-weight:600;color:#d6daec;text-align:left}
tbody tr:nth-child(odd) td{background:rgba(255,255,255,.01)}
.note, .seedname{width:100%;padding:8px 10px;border-radius:10px;border:1px solid #2a2d40;background:#10121a;color:#eaeaf2}
.choice{cursor:pointer;display:grid;place-items:center;height:40px;border-radius:10px;border:1px solid #2a2d40;background:#131522;font-weight:700;user-select:none}
.good{border-color:#265a3a;background:rgba(118,255,157,.10)}
.ok{border-color:#6b5a26;background:rgba(255,211,107,.10)}
.bad{border-color:#6b2636;background:rgba(255,107,138,.10)}
.rowtools{display:flex;gap:6px}
.iconbtn{width:28px;height:28px;border-radius:8px;border:1px solid #2a2d40;background:#151726;color:#e9ecff}
.legend{display:flex;flex-wrap:wrap;gap:8px}
.key{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px dashed #2a2d40;border-radius:10px;background:#141623;color:#cfd3ea}
.badgebox{display:inline-grid;place-items:center;width:26px;height:22px;border-radius:8px;border:1px solid #2a2d40;background:#10121a;font-weight:700}
.controls{display:flex;flex-wrap:wrap;gap:8px}
.btn{padding:10px 12px;border-radius:10px;border:1px solid #23263a;background:#151726;color:#e9ecff}
.footer{margin-top:12px;color:var(--muted);display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap}
.pill{display:inline-flex;align-items:center;gap:6px;padding:3px 8px;border-radius:999px;border:1px solid #2a2d40;background:#141522;color:#c9cde0;font-size:12px}
.switch{appearance:none;width:42px;height:24px;border-radius:999px;background:#2a2d40;position:relative;outline:none;border:1px solid #353a55}
.switch:checked{background:#22404a;border-color:#285864;box-shadow:0 0 0 3px rgba(157,252,255,.15) inset}
.switch:before{content:"";position:absolute;top:3px;left:3px;width:18px;height:18px;border-radius:50%;background:#cbd5e1;transition:transform .18s ease}
.switch:checked:before{transform:translateX(18px)}
.hidden{display:none}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand"><div class="dot"></div><div><h1>Compatibility Grid</h1><div class="sub">Seeds Ã— Honey Â· Smoke Â· Neon Â· Dreams Â· Sex</div></div></div>
    <nav>
      <a href="/jar/">Jar</a>
      <a href="/calendar/illumina1/">Calendar</a>
      <a href="/day/">Day</a>
      <a href="/tunes/">Tunes</a>
      <a href="/interludes/">Interludes</a>
      <a href="/seeds/">Seeds</a>
      <a href="/references/">References</a>
      <a href="/archive/">Archive</a>
      <a href="/science/">Science</a>
      <a href="/compatibility/">Compatibility</a>
      <a href="/dreams/">Dreams</a>
      <a href="/storage/">Storage</a>
      <a href="/pollen/">Pollen</a>
      <a href="/modes/neon/">Modes</a>
    </nav>
  </header>

  <div class="panel" style="margin-bottom:12px">
    <div style="display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between">
      <div class="legend">
        <span class="key"><span class="badgebox good">âœ“</span> Harmonic</span>
        <span class="key"><span class="badgebox ok">~</span> Neutral</span>
        <span class="key"><span class="badgebox bad">âœ—</span> Clash</span>
      </div>
      <div class="controls">
        <button class="btn" id="exportBtn">Export JSON</button>
        <label class="btn" for="importFile" style="cursor:pointer">Import JSON</label>
        <input id="importFile" type="file" accept="application/json" class="hidden" />
        <button class="btn" id="resetBtn">Reset Grid</button>
        <button class="btn" id="addSeedBtn">Add Seed</button>
      </div>
    </div>
  </div>

  <div class="gridwrap">
    <table id="grid" aria-label="Compatibility grid">
      <thead>
        <tr>
          <th style="min-width:250px">Seed</th>
          <th>Honey</th>
          <th>Smoke</th>
          <th>Neon</th>
          <th>Dreams</th>
          <th>Sex</th>
          <th style="min-width:240px">Notes</th>
          <th>Tools</th>
        </tr>
      </thead>
      <tbody id="gridBody"></tbody>
    </table>
  </div>

  <div class="footer">
    <div>Local keys: <code>jar_compat_v1</code> (migrates from <code>jar_compatibility_v1</code> if present)</div>
    <div>Need seed pages? Try <a href="/seeds/">/seeds/</a></div>
  </div>
</div>

<template id="rowTemplate">
  <tr>
    <td>
      <div style="display:grid;gap:6px">
        <input class="seedname" type="text" placeholder="Seed name (e.g., Pumpkin)">
        <label style="display:inline-flex;gap:8px;align-items:center">
          <span class="pill">Chewed</span>
          <input type="checkbox" class="switch modeToggle" aria-label="Swallow instead of chew">
          <span class="pill">Swallowed</span>
        </label>
      </div>
    </td>
    <td><div class="choice ok" data-key="honey">~</div></td>
    <td><div class="choice ok" data-key="smoke">~</div></td>
    <td><div class="choice ok" data-key="neon">~</div></td>
    <td><div class="choice ok" data-key="dreams">~</div></td>
    <td><div class="choice ok" data-key="sex">~</div></td>
    <td><textarea class="note" rows="2" placeholder="Why this pairing? timing, dose, orderâ€¦"></textarea></td>
    <td class="rowtools">
      <button class="iconbtn moveUp" title="Move up" aria-label="Move up">â–²</button>
      <button class="iconbtn moveDown" title="Move down" aria-label="Move down">â–¼</button>
      <button class="iconbtn delRow" title="Remove" aria-label="Remove">âœ•</button>
    </td>
  </tr>
</template>

<script>
/* ---------- Storage keys + migration ---------- */
const KEY_NEW = "jar_compat_v1";
const KEY_OLD = "jar_compatibility_v1";

/* ---------- State helpers ---------- */
const STATES = [
  { cls:"ok",   label:"~" },
  { cls:"good", label:"âœ“" },
  { cls:"bad",  label:"âœ—" }
];

function migrateIfNeeded(){
  try{
    const old = localStorage.getItem(KEY_OLD);
    const cur = localStorage.getItem(KEY_NEW);
    if(old && !cur){ localStorage.setItem(KEY_NEW, old); }
  }catch(_){}
}

function load(){
  migrateIfNeeded();
  try{ const raw = localStorage.getItem(KEY_NEW); return raw ? JSON.parse(raw) : null; }
  catch(_){ return null; }
}
function save(){
  const rows = Array.from(document.querySelectorAll("#gridBody tr")).map(tr => {
    const getState = k => tr.querySelector(`.choice[data-key="${k}"]`).dataset.state || "ok";
    return {
      name: tr.querySelector(".seedname").value.trim(),
      swallowed: tr.querySelector(".modeToggle").checked,
      honey: getState("honey"),
      smoke: getState("smoke"),
      neon:  getState("neon"),
      dreams:getState("dreams"),
      sex:   getState("sex"),
      note:  tr.querySelector(".note").value.trim()
    };
  });
  localStorage.setItem(KEY_NEW, JSON.stringify(rows));
}

/* ---------- UI builders ---------- */
const gridBody = document.getElementById("gridBody");
const tpl = document.getElementById("rowTemplate").content;

function stateClass(v){ return v==="good"?"good":(v==="bad"?"bad":"ok"); }

function cycleState(el){
  const cur = el.dataset.state || "ok";
  const idx = STATES.findIndex(s => s.cls===cur);
  const next = STATES[(idx+1)%STATES.length];
  el.dataset.state = next.cls;
  el.classList.remove("ok","good","bad");
  el.classList.add(next.cls);
  el.textContent = next.label;
}

function wireRow(tr, row){
  const name = tr.querySelector(".seedname");
  const note = tr.querySelector(".note");
  const toggle = tr.querySelector(".modeToggle");
  const choices = tr.querySelectorAll(".choice");

  name.value = row.name || "";
  note.value = row.note || "";
  toggle.checked = !!row.swallowed;

  const def = {honey:"ok",smoke:"ok",neon:"ok",dreams:"ok",sex:"ok"};
  ["honey","smoke","neon","dreams","sex"].forEach(k=>{
    const v = (row[k] || def[k]);
    const cell = tr.querySelector(`.choice[data-key="${k}"]`);
    cell.dataset.state = v;
    cell.classList.add(stateClass(v));
    cell.textContent = v==="good"?"âœ“":(v==="bad"?"âœ—":"~");
    cell.addEventListener("click", ()=>{ cycleState(cell); save(); });
  });

  name.addEventListener("input", save);
  note.addEventListener("input", save);
  toggle.addEventListener("change", save);

  tr.querySelector(".delRow").addEventListener("click", ()=>{ tr.remove(); save(); });
  tr.querySelector(".moveUp").addEventListener("click", ()=>{
    const prev = tr.previousElementSibling; if(prev){ gridBody.insertBefore(tr, prev); save(); }
  });
  tr.querySelector(".moveDown").addEventListener("click", ()=>{
    const next = tr.nextElementSibling; if(next){ gridBody.insertBefore(next, tr); save(); }
  });
}

function makeRow(row){
  const node = document.importNode(tpl, true).firstElementChild;
  wireRow(node, row||{});
  return node;
}

function render(data){
  gridBody.innerHTML = "";
  (data && Array.isArray(data) ? data : DEFAULT_ROWS).forEach(r=>{
    gridBody.appendChild(makeRow(r));
  });
  save();
}

/* ---------- Defaults (can edit safely) ---------- */
const DEFAULT_ROWS = [
  {name:"Cosmic Apple", swallowed:false, honey:"good", smoke:"ok",  neon:"ok",   dreams:"good", sex:"ok", note:"Pairs with dreams; gentle."},
  {name:"Pumpkin",      swallowed:true,  honey:"ok",   smoke:"ok",  neon:"good", dreams:"ok",   sex:"ok", note:"Comfort / softness reset."},
  {name:"Mustard",      swallowed:false, honey:"good", smoke:"bad", neon:"ok",   dreams:"ok",   sex:"ok", note:"Use honey buffer; avoid smoke."},
  {name:"Cumin",        swallowed:false, honey:"good", smoke:"ok",  neon:"ok",   dreams:"ok",   sex:"ok", note:"Gentle smoke allowed; reflection."},
  {name:"Gala Apple",   swallowed:false, honey:"ok",   smoke:"ok",  neon:"good", dreams:"ok",   sex:"ok", note:"Light, bright; post-dream reset."},
  {name:"Royal Orange", swallowed:true,  honey:"good", smoke:"ok",  neon:"ok",   dreams:"good", sex:"ok", note:"Checkpoint seed (7/14/21/28/35/42)."},
  {name:"Chili Flake",  swallowed:true,  honey:"ok",   smoke:"bad", neon:"good", dreams:"ok",   sex:"ok", note:"Neon nights only; micro-dose."}
];

/* ---------- Controls ---------- */
document.getElementById("addSeedBtn").addEventListener("click", ()=>{
  gridBody.appendChild(makeRow({name:"New Seed", swallowed:false}));
  save();
});
document.getElementById("exportBtn").addEventListener("click", ()=>{
  const blob = new Blob([localStorage.getItem(KEY_NEW)||"[]"], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a"); a.href=url; a.download="jar_compat.json";
  document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),500);
});
document.getElementById("importFile").addEventListener("change", e=>{
  const f = e.target.files && e.target.files[0]; if(!f) return;
  const fr = new FileReader();
  fr.onload = ()=>{
    try{
      const data = JSON.parse(fr.result);
      if(Array.isArray(data)){ localStorage.setItem(KEY_NEW, JSON.stringify(data)); render(data); }
    }catch(_){}
    e.target.value = "";
  };
  fr.readAsText(f);
});
document.getElementById("resetBtn").addEventListener("click", ()=>{
  localStorage.removeItem(KEY_NEW);
  render(DEFAULT_ROWS);
});

/* ---------- Init ---------- */
(function init(){
  const data = load();
  render(data);
})();
</script>
</body>
</html>
