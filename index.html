<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Equations of Honey · Jar</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' x='0.1em' font-size='90'%3E%F0%9F%8D%AF%3C/text%3E%3C/svg%3E">
<style>
:root{--bg:#0c0b0a;--ink:#f3efe7;--honey:#ffc847;--line:#26231f}
*{box-sizing:border-box} html,body{height:100%} body{margin:0;background:radial-gradient(1200px 800px at 20% 0%,#171513,#0a0908 70%),var(--bg);color:var(--ink);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto}
.wrap{max-width:1100px;margin:0 auto;padding:20px}
header{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:space-between}
.brand{display:flex;align-items:center;gap:10px}
.dot{width:10px;height:10px;border-radius:999px;background:var(--honey);box-shadow:0 0 16px var(--honey)}
h1{margin:0;font-size:clamp(18px,3.5vw,26px)} .small{opacity:.8;font-size:12px}
nav.steps{display:flex;gap:8px;overflow-x:auto;-webkit-overflow-scrolling:touch}
nav.steps button{flex:0 0 auto;border:1px solid var(--line);background:linear-gradient(180deg,#191715,#121110);color:var(--ink);padding:8px 10px;border-radius:10px;font-size:13px;cursor:pointer}
nav.steps button[data-active="true"]{outline:2px solid var(--honey);box-shadow:0 0 0 3px rgba(255,200,71,.18)}
nav.steps button[data-done="true"]{box-shadow: 0 0 0 2px rgba(255,200,71,0.15), inset 0 0 14px rgba(255,200,71,0.18)}
.btn{border:1px solid var(--line);background:linear-gradient(180deg,#1b1815,#14120f);color:var(--ink);padding:8px 10px;border-radius:10px;cursor:pointer;text-decoration:none;display:inline-block}
.progress{height:10px;border-radius:999px;background:#141210;border:1px solid var(--line);margin:6px 0 12px;overflow:hidden}
.progress .bar{height:100%;width:0%;background:linear-gradient(90deg,#ffc847,#ffb300)}
.book{border:1px solid #1e1b18;border-radius:16px;background:linear-gradient(180deg,#141210,#110f0d);box-shadow:0 30px 90px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.04);overflow:hidden}
.ribbon{position:relative;padding:8px 12px;background:linear-gradient(90deg,#ffc847,#ffb300);color:#2a1b00;font-weight:700}
.spread{display:grid;grid-template-columns:1fr;gap:0}@media(min-width:900px){.spread{grid-template-columns:1fr 1fr}}
.page{padding:20px;border-top:1px solid var(--line)} .page:first-child{border-right:1px solid var(--line)}
.gridpaper{border:1px dashed var(--line);border-radius:12px;padding:12px}
.equation{display:inline-block;padding:6px 10px;border-radius:10px;background:rgba(255,200,71,.08);border:1px solid rgba(255,200,71,.2);font-weight:700}
.foot{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:14px;border-top:1px solid var(--line)}
.pill{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);padding:6px 10px;border-radius:999px;font-size:12px}
.status{width:10px;height:10px;border-radius:999px;background:#6b6b6b}.status.done{background:#7bd88f;box-shadow:0 0 12px #7bd88f}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="dot"></div>
      <div>
        <h1>Equations of Honey · Jar</h1>
        <div class="small">42-day core · 6 interludes · extras</div>
      </div>
    </div>
    <div class="small" id="nowPlaying">Now playing: D01</div>
    <nav class="steps" id="steps"></nav>
    <a class="btn" id="tunesBtn" href="https://tunes.plnt.earth/#d01" target="_blank" rel="noopener">Tunes</a>
  </header>

  <div class="progress"><div class="bar" id="bar"></div></div>

  <div class="book">
    <div class="ribbon" id="rib">Day 1 / 42</div>
    <section class="spread" id="spread"></section>
    <div class="foot">
      <div>
        <button class="btn" id="prev">◀ Prev</button>
        <button class="btn" id="next">Next ▶</button>
      </div>
      <div class="pill"><span class="status" id="dot"></span><span id="msg">Progress saved</span></div>
    </div>
  </div>
</div>

<script>
  // --- Build 42 core + 6 interludes + 2 extras
  function day(n){const tag=String(n).padStart(2,'0');return {core:true,title:'D'+tag,left:`<h2>Left · Puzzle</h2><div class="equation">Day ${n}</div><div class="gridpaper"><p>Workspace</p></div>`,right:`<h2>Right · Honey Ritual</h2><div class="gridpaper"><p>One spoon of honey. ${n} slow breaths.</p></div>`};}
  const core = Array.from({length:42},(_,i)=>day(i+1));
  const inter = [
    {interlude:true,title:'IL1',left:`<h2>Interlude · Honey/Taste</h2><div class="gridpaper"><p>Savor + note.</p></div>`,right:`<h2>Play</h2><div class="gridpaper"><p>Sketch flavor wheel.</p></div>`},
    {interlude:true,title:'IL2',left:`<h2>Interlude · Curiosity</h2><div class="gridpaper"><p>One sky-question.</p></div>`,right:`<h2>Play</h2><div class="gridpaper"><p>10-min experiment plan.</p></div>`},
    {interlude:true,title:'IL3',left:`<h2>Interlude · Confrontation</h2><div class="gridpaper"><p>Name one friction.</p></div>`,right:`<h2>Play</h2><div class="gridpaper"><p>Write a 2-line bar.</p></div>`},
    {interlude:true,title:'IL4',left:`<h2>Interlude · Identity</h2><div class="gridpaper"><p>Which mask to set down?</p></div>`,right:`<h2>Play</h2><div class="gridpaper"><p>Storyboard 3 frames.</p></div>`},
    {interlude:true,title:'IL5',left:`<h2>Interlude · Trickster</h2><div class="gridpaper"><p>Break one tiny rule.</p></div>`,right:`<h2>Play</h2><div class="gridpaper"><p>3 playful constraints.</p></div>`},
    {interlude:true,title:'IL6',left:`<h2>Interlude · Collective Joy</h2><div class="gridpaper"><p>Invite a 6-min ritual.</p></div>`,right:`<h2>Play</h2><div class="gridpaper"><p>Plan a swarm moment.</p></div>`},
  ];
  const extra = [
    {title:'Cyclic',left:`<h2>Cyclic Honey (142857)</h2><div class="gridpaper"><p>Rotations of 142857.</p></div>`,right:`<h2>Ritual</h2><div class="gridpaper"><p>Whisper 1-4-2-8-5-7, rotate.</p></div>`},
    {title:'Victory',left:`<h2>☀️ Victory Song</h2><div class="gridpaper"><p>Write your stanza.</p></div>`,right:`<h2>Ritual</h2><div class="gridpaper"><p>Speak aloud.</p></div>`}
  ];

  const spreads=[];
  for(let i=1;i<=42;i++){ spreads.push(core[i-1]); if([7,14,21,28,35,42].includes(i)) spreads.push(inter[(i/7)-1]); }
  spreads.push(...extra);

  // --- State
  const stepsEl=document.getElementById('steps'), spreadEl=document.getElementById('spread'), rib=document.getElementById('rib');
  const bar=document.getElementById('bar'), dot=document.getElementById('dot'), msg=document.getElementById('msg');
  const tunesBtn=document.getElementById('tunesBtn'), nowLab=document.getElementById('nowPlaying');

  const s=JSON.parse(localStorage.getItem('jar42')||'{}'); if(typeof s.page!=='number') s.page=1; if(!s.done) s.done={};
  function save(){ localStorage.setItem('jar42', JSON.stringify(s)); }

  function proofPct(){ const total=42; const done=Object.keys(s.done).filter(k=>/^D\d{2}$/.test(k)&&s.done[k]).length; return Math.round(done/total*100)||0; }
  function updateProgress(){ const p=proofPct(); bar.style.width=p+'%'; dot.classList.toggle('done', p===100); }

  function steps(){
    stepsEl.innerHTML='';
    spreads.forEach((sp,idx)=>{
      const b=document.createElement('button');
      b.textContent = sp.core ? sp.title : (sp.title==='Victory'?'VS':(sp.title==='Cyclic'?'EX':sp.title));
      b.setAttribute('data-active', String(idx+1===s.page));
      b.setAttribute('data-done', String(!!s.done[sp.title]));
      b.title = sp.title;
      b.onclick=()=>{ s.page=idx+1; save(); render(); };
      stepsEl.appendChild(b);
    });
  }

  function tunesAnchor(sp, coreIndex){
    if(sp.core){ return '#d'+String(coreIndex+1).padStart(2,'0'); }
    if(sp.title==='Cyclic') return '#cyclic';
    if(sp.title==='Victory') return '#victory';
    const idx = [7,14,21,28,35,42].indexOf(coreIndex+1)>=0 ? Math.floor(coreIndex/7) : Math.min(5, Math.floor(coreIndex/7));
    return '#il'+(idx+1);
  }

  function render(){
    const sp = spreads[s.page-1] || spreads[0];
    const coreOnly = spreads.filter(x=>x.core);
    const ci = coreOnly.indexOf(sp);
    rib.textContent = sp.core ? `Day ${ci+1} / ${coreOnly.length}` : `Extra · ${sp.title}`;
    location.hash = '#s='+s.page;

    // pages
    spreadEl.innerHTML='';
    const L=document.createElement('div'); L.className='page'; L.innerHTML=sp.left;
    const R=document.createElement('div'); R.className='page'; R.innerHTML=sp.right;
    const ctrl=document.createElement('div'); ctrl.style.marginTop='12px';
    const btn=document.createElement('button'); btn.className='btn';
    function setLabel(){ btn.textContent = s.done[sp.title] ? '✓ Marked Complete — click to undo' : 'Mark Complete'; }
    setLabel();
    btn.onclick=()=>{ s.done[sp.title]=!s.done[sp.title]; save(); setLabel(); steps(); updateProgress(); };
    ctrl.appendChild(btn); L.appendChild(ctrl);
    spreadEl.appendChild(L); spreadEl.appendChild(R);

    // steps & progress
    steps(); updateProgress(); msg.textContent='Progress saved';

    // tunes link + label
    const a = tunesAnchor(sp, ci<0?0:ci);
    tunesBtn.href = 'https://tunes.plnt.earth/'+a;
    nowLab.textContent = 'Now playing: ' + (sp.core? sp.title : (sp.title==='Cyclic'?'Cyclic': (sp.title==='Victory'?'Victory':sp.title)));
  }

  // init + deep link
  function jump(){ const m=(location.hash||'').match(/#s=(\d+)/i); if(m){ const n=Math.max(1, Math.min(spreads.length, parseInt(m[1],10))); if(n!==s.page){ s.page=n; save(); } } }
  jump(); render(); save();
  document.getElementById('prev').onclick=()=>{ s.page=Math.max(1,s.page-1); save(); render(); };
  document.getElementById('next').onclick=()=>{ s.page=Math.min(spreads.length,s.page+1); save(); render(); };

  // hotkeys
  document.addEventListener('keydown',e=>{
    const tag=(document.activeElement&&document.activeElement.tagName)||'';
    if(/INPUT|TEXTAREA|SELECT/.test(tag)) return;
    if(e.key==='c'||e.key==='C'){ const sp=spreads[s.page-1]; s.done[sp.title]=!s.done[sp.title]; save(); steps(); render(); }
    if(e.key==='ArrowLeft'){ e.preventDefault(); document.getElementById('prev').click(); }
    if(e.key==='ArrowRight'){ e.preventDefault(); document.getElementById('next').click(); }
  });
  window.addEventListener('hashchange',()=>{ jump(); render(); });
</script>
</body>
</html>
